# 再谈类的加载器

## 概述

类加载器是 JVM 执行类加载机制的前提

**ClassLoader 的作用：**

ClassLoader 是 Java 的核心组件，所有的 Class 都是由 ClassLoader 进行加载的，ClassLoader 负责通过各种方式将 Class 信息的二进制数据流读入 JVM 内部，转换为一个与目标类对应的 java.lang.Class 对象实例。然后交给 Java 虚拟机尽心链接、初始化等操作。因此，ClassLoader 在整个装载阶段，只能影响到类的加载，而无法通过 ClassLoader 去改变类的链接和初始化行为。至于它是否可以运行，则由 Execution Engine 决定。

<img src="https://note-java.oss-cn-beijing.aliyuncs.com/img/image-20210412224218173.png" alt="image-20210412224218173" style="zoom:60%;" />

类加载器最早出现在 Java 1.0 版本中，那个时候只是单纯地为了满足 Java Applet 应用而被研发出来，但如今类加载器却在 OSGI、字节码加解密领域大放异彩。这主要归功于 Java 虚拟机的设计者们当初在设计类加载器的时候，并没有考虑将它绑定在 JVM 内部，这样做的好处就是能够更加灵活和动态地执行类加载操作。



### 大厂面试题

蚂蚁金服：

- 深入分析 ClassLoader，双亲委派机制

- 类加载器的双亲委派模型是什么？

- 一面：双亲委派机制及使用原因


百度：

- 都有哪些类加载器，这些类加载器都加载哪些文件？

- 手写一个类加载器 Demo

- Class 的 forName("java.lang.String") 和 Class 的 getClassLoader() 的 loadClass("java.lang.String")有什么区别？


腾讯：

- 什么是双亲委派模型？

- 类加载器有哪些？


小米：

- 双亲委派模型介绍一下


滴滴：

- 简单说说你了解的类加载器

- 一面：讲一下双亲委派模型，以及其优点


字节跳动：

- 什么事类加载器，类加载器有哪些？


京东：

- 类加载器的双亲委派模型是什么？

- 双亲委派机制可以打破吗？为什么？



### 类加载的分类

类的加载分类：显式加载 vs 隐式加载

Class 文件的显式加载与隐式加载的方式是指 JVM 加载 Class 文件到内存的方式

- 显式加载指的是在代码中通过调用 ClassLoader 加载 Class 对象，如直接使用 Class.forName(name) 或 this.getClass().getClassLoader().loadClass() 加载 Class 对象
- 隐式加载则是不直接在代码中调用 ClassLoader 的方法加载 Class 对象，而是通过虚拟机自动加载到内存中，如在加载某个类的 Class 文件时，该类的 Class 文件中引用了另外一个类的对象，此时额外引用的类将通过 JVM 自动加载到内存中

在日常开发中以上两种方式一般会混合使用

```java
public class UserTest {
    public static void main(String[] args) {
        User user = new User(); //隐式加载

        try {
            Class clazz = Class.forName("com.atguigu.java.User"); //显式加载
            ClassLoader.getSystemClassLoader().loadClass("com.atguigu.java.User");//显式加载
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }

    }
}
```

### 类加载的必要性

### 命名空间

### 类加载机制的基本特征

## 复习：类的加载器分类

### 引导类加载器

### 拓展类加载器

### 系统类加载器

### 用户自定义类加载器

## 测试不同的类加载器

## ClassLoader源码解析

### ClassLoader的主要方法

### SecureClassLoader与URLClassLoader

### ExtClassLoader与AppClassLoader

### Class.forName与ClassLoader.loadClass()

### 双亲委派模型

### 定义与本质

### 优势与劣势

### 破坏双亲委派机制

### 热替换的实现

## 沙箱安全机制

### JDK1.0时期

### JDK1.1时期

### JDK1.2时期

### JDK1.6时期

## 自定义类的加载器

## java9新特性